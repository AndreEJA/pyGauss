{% extends "base.html" %}
{% block content %}
<div class="space-y-8">
  <section class="panel">
    <h2 class="panel-title text-slate-900">Regla de Cramer</h2>
    <p class="text-sm text-slate-600 mb-4">
      Resuelve sistemas de ecuaciones Ax = b donde A es una matriz cuadrada e
      invertible, usando el c√°lculo de determinantes.
    </p>

    <div class="grid grid-cols-1 sm:grid-cols-4 gap-4 items-end">
      <label class="block">
        <span class="lbl">Orden (n para n√ón)</span>
        <input id="inp-orden" type="number" min="2" value="3" class="input" />
      </label>
      <div class="sm:col-span-3">
        <button id="btn-crear" class="btn-primary w-full">
          Crear Sistema Ax = b
        </button>
      </div>
    </div>

    <!-- üîπ NUEVO: SISTEMA DE ECUACIONES ‚Üí A y b -->
    <div class="mt-6 space-y-3">
      <h3 class="text-base font-semibold text-slate-900">
        Sistema de ecuaciones (opcional)
      </h3>

      <p class="text-sm text-slate-600">
        Escribe un sistema lineal Ax = b y luego usa
        <span class="font-semibold">‚ÄúCargar sistema en A y b‚Äù</span>
        para construir autom√°ticamente la matriz A (coeficientes) y el vector b.
      </p>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
        <!-- Sistema -->
        <div class="space-y-2">
          <label for="txt-sistema" class="lbl">Sistema</label>
          <textarea
            id="txt-sistema"
            class="input w-full min-h-[140px]"
            placeholder="Ejemplo:
2x + 3y - z = 5
x - y + 4z = 7
-x + 2y + z = 1"
          ></textarea>
          <p class="text-xs text-slate-500">
            Una ecuaci√≥n por l√≠nea, siempre con <code>=</code>. Se permite
            multiplicaci√≥n impl√≠cita como <code>2x</code>, <code>3(x+1)</code>, etc.
          </p>
        </div>

        <!-- Orden de variables + bot√≥n -->
        <div class="space-y-3">
          <div class="space-y-2">
            <label for="inp-variables-sistema" class="lbl">
              Orden de las variables (opcional)
            </label>
            <input
              id="inp-variables-sistema"
              type="text"
              class="input w-full"
              placeholder="x, y, z"
            />
            <p class="text-xs text-slate-500">
              Si lo dejas vac√≠o, el programa detecta las variables y las ordena alfab√©ticamente.
            </p>
          </div>

          <div>
            <button
              id="btn-sistema-a-matrices"
              type="button"
              class="btn-accent w-full"
            >
              Cargar sistema en A y b
            </button>
            <p class="text-xs text-slate-500 mt-1">
              Este bot√≥n rellenar√° A con los coeficientes de las inc√≥gnitas y b con
              los t√©rminos independientes, ajustando el orden n seg√∫n el sistema.
            </p>
          </div>
        </div>
      </div>
    </div>
    <!-- üîπ FIN NUEVO BLOQUE -->
  </section>

  <section id="zona-matrices" class="panel hidden">
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
      <div class="sm:col-span-2">
        <h3 class="text-lg font-semibold text-slate-900 mb-3">
          Matriz A (n√ón)
        </h3>
        <div class="overflow-auto rounded-xl border border-slate-200">
          <table id="tabla-A" class="matrix-table w-full"></table>
        </div>
      </div>
      <div>
        <h3 class="text-lg font-semibold text-slate-900 mb-3">
          Vector b (n√ó1)
        </h3>
        <div class="overflow-auto rounded-xl border border-slate-200">
          <table id="tabla-b" class="matrix-table w-full"></table>
        </div>
      </div>
    </div>

    <!-- TECLADO: ahora con estilo moderno, sin romper el JS -->
    <div class="kbd-row keypad mt-3">
      <button class="kbd key" data-ins="pi">œÄ</button>
      <button class="kbd key" data-ins="e">e</button>
      <button class="kbd key" data-ins="sqrt()">‚àö</button>
      <button class="kbd key" data-ins="sin()">sin</button>
      <button class="kbd key" data-ins="cos()">cos</button>
      <button class="kbd key" data-ins="tan()">tan</button>
      <button class="kbd key" data-ins="^">x^</button>
      <button class="kbd key" data-ins="/">/</button>
      <button class="kbd key" data-ins="(">(</button>
      <button class="kbd key" data-ins=")">)</button>
      <button class="kbd key" data-ins="+">+</button>
      <button class="kbd key" data-ins="-">-</button>
    </div>

    <div class="mt-4 flex gap-3 flex-wrap items-end">
      <label class="block">
        <span class="lbl">Modo</span>
        <select id="sel-modo" class="input">
          <option value="fraccion">Fracciones</option>
          <option value="decimal">Decimales</option>
        </select>
      </label>
      <label class="block">
        <span class="lbl">Decimales</span>
        <input
          id="inp-decimales"
          type="number"
          min="0"
          value="6"
          class="input w-28"
        />
      </label>
      <button id="btn-resolver" class="btn-accent">Resolver por Cramer</button>
      <span id="msg" class="text-sm text-slate-500"></span>
    </div>
  </section>

  <section id="zona-detA" class="panel hidden">
    <h3 class="text-lg font-semibold text-slate-900 mb-3">
      Paso 1: C√°lculo de det(A)
    </h3>
    <div id="valor-detA" class="text-xl font-bold mb-3"></div>
    <div id="lista-pasos-detA" class="space-y-4"></div>
  </section>

  <section id="zona-cramer" class="panel hidden">
    <h3 class="text-lg font-semibold text-slate-900 mb-3">
      Paso 2: Determinantes det A(b) y Soluci√≥n
    </h3>
    <div id="cramer-message" class="text-slate-700 font-medium mb-4"></div>
    <div id="lista-pasos-cramer" class="space-y-6"></div>
  </section>

  <section id="zona-resultado" class="panel final-card hidden">
    <h3 class="text-lg font-semibold text-slate-900 mb-2">Soluci√≥n Final</h3>
    <ul id="resultado-solucion" class="mt-3 grid sm:grid-cols-2 gap-2"></ul>
  </section>
</div>
{% endblock %}
{% block extra_js %}
<script src="{{ url_for('static', filename='js/cramer.js') }}"></script>
{% endblock %}
