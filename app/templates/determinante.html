{% extends "base.html" %}

{% block content %}

<!-- MathLive para celdas bonitas -->
<script defer src="https://cdn.jsdelivr.net/npm/mathlive"></script>

<style>
  /* Ocultar botones del teclado virtual de MathLive */
  math-field::part(virtual-keyboard-toggle),
  math-field::part(menu-toggle) {
    display: none !important;
  }

  /* Estilo de los math-field dentro de la tabla */
  .matrix-table td math-field {
    display: block;
    width: 100%;
    height: 100%;
    padding: 0.25rem 0.5rem;
    box-sizing: border-box;
    border-radius: 0.75rem;
    border: none;
    background: transparent;
    color: inherit;
  }

  .matrix-table td math-field::part(content) {
    color: inherit;
  }
</style>

<div class="space-y-8">
  <!-- ================= DETERMINANTE NORMAL ================= -->
  <section class="panel">
    <h2 class="panel-title text-slate-900">
      Determinante de una Matriz Cuadrada
    </h2>
    <div class="grid grid-cols-1 sm:grid-cols-4 gap-4 items-end">
      <label class="block">
        <span class="lbl">Orden (n para n×n)</span>
        <input
          id="inp-orden"
          type="number"
          min="2"
          class="input"
          placeholder="3"
        />
      </label>
      <div class="sm:col-span-3">
        <button id="btn-crear" class="btn-primary w-full">Crear Matriz</button>
      </div>
    </div>
    <p class="text-sm text-slate-600 mt-2">
      Para n=2 se usa la fórmula de \(ad - bc\). Para n &gt; 2 se usa la
      reducción por filas (método de Gauss).
    </p>
  </section>

  <section id="zona-matriz" class="panel hidden">
    <h3 class="text-lg font-semibold text-slate-900 mb-3">Matriz A (n×n)</h3>
    <div class="min-w-full overflow-auto rounded-xl border border-slate-200">
      <table id="tabla-A" class="matrix-table w-full"></table>
    </div>

    <!-- TECLADO con estilo unificado -->
    <div class="kbd-row keypad mt-3">
      <button class="kbd key" data-ins="pi">π</button>
      <button class="kbd key" data-ins="e">e</button>
      <button class="kbd key" data-ins="sqrt()">√</button>
      <button class="kbd key" data-ins="sin()">sin</button>
      <button class="kbd key" data-ins="cos()">cos</button>
      <button class="kbd key" data-ins="tan()">tan</button>
      <button class="kbd key" data-ins="^">x^</button>
      <button class="kbd key" data-ins="/">/</button>
      <button class="kbd key" data-ins="(">(</button>
      <button class="kbd key" data-ins=")">)</button>
      <button class="kbd key" data-ins="+">+</button>
      <button class="kbd key" data-ins="-">−</button>
    </div>

    <div class="mt-4 flex gap-3 flex-wrap items-end">
      <label class="block">
        <span class="lbl">Modo</span>
        <select id="sel-modo" class="input">
          <option value="fraccion">Fracciones</option>
          <option value="decimal">Decimales</option>
        </select>
      </label>
      <label class="block">
        <span class="lbl">Decimales</span>
        <input
          id="inp-decimales"
          type="number"
          min="0"
          class="input w-28"
          placeholder="6"
        />
      </label>
      <button id="btn-resolver" class="btn-accent">
        Calcular Determinante
      </button>
      <span id="msg" class="text-sm text-slate-500"></span>
    </div>
  </section>

  <section id="zona-pasos" class="panel hidden">
    <h3 class="text-lg font-semibold text-slate-900 mb-3">
      Pasos de Reducción (n &gt; 2)
    </h3>
    <div id="lista-pasos" class="space-y-4"></div>
  </section>

  <section id="zona-resultado" class="panel final-card hidden">
    <h3 class="text-lg font-semibold text-slate-900 mb-2">Resultado: det(A)</h3>
    <div
      id="resultado-valor"
      class="text-2xl font-extrabold text-slate-900"
    ></div>
  </section>

  <!-- ================== NUEVO 1: det(kA) ================== -->
  <section class="panel">
    <h3 class="text-lg font-semibold text-slate-900 mb-2">
      Determinantes y escalares
    </h3>
    <p class="text-sm text-slate-600 mb-3">
      Si conoces el determinante de una matriz cuadrada A de orden n, puedes
      calcular el determinante de kA usando la propiedad
      <strong>det(kA) = k<sup>n</sup> · det(A)</strong>.
    </p>

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      <label class="block">
        <span class="lbl">Orden n (por ejemplo, 3 para una 3×3)</span>
        <input
          id="inp-det-n"
          type="number"
          min="1"
          class="input"
          placeholder="3"
        />
      </label>
      <label class="block">
        <span class="lbl">det(A)</span>
        <input
          id="inp-detA"
          type="text"
          class="input"
          placeholder="5"
        />
      </label>
      <label class="block">
        <span class="lbl">Escalar k</span>
        <input
          id="inp-k"
          type="text"
          class="input"
          placeholder="2"
        />
      </label>
    </div>

    <div class="mt-4 space-y-4">
      <button id="btn-det-kA" class="btn-accent">
        Calcular det(kA)
      </button>

      <!-- tarjeta de resultado centrada -->
      <div
        id="res-det-kA-card"
        class="hidden rounded-2xl border border-slate-200 bg-white/90 shadow-sm p-5"
      >
        <div class="text-center mb-4">
          <p class="text-xs uppercase tracking-wide text-slate-500">
            det(kA)
          </p>
          <p
            id="res-det-kA-valor"
            class="text-4xl font-extrabold text-slate-900"
          ></p>
        </div>

        <hr class="my-3 border-slate-200" />

        <div
          class="text-center text-sm text-slate-600 leading-relaxed space-y-1"
        >
          <p>  
            <strong>Explicación</strong>
          </p>
          <p>
            n =
            <span id="res-det-n"></span>, det(A) =
            <span id="res-det-detA"></span>, k =
            <span id="res-det-k"></span>
          </p>
          <p>kⁿ = <span id="res-det-kpow"></span></p>
          <p>
            Entonces <strong>det(kA)</strong> =
            <span id="res-det-formula"></span>
          </p>
        </div>
      </div>
    </div>
  </section>


{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/determinante.js') }}" defer></script>
{% endblock %}
